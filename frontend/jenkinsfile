pipeline {
  agent any

  environment {
    registryCredential = ‘nexusrm’
  }

  stages {
    stage('gitclone') {
      steps {
        git 'https://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@github.com/EAS-KHALID/khalidcitask.git"
      }
    }
    
    
    stage('SonarScanner') {
      steps {
        withSonarQubeEnv('khalidsonar') {
          sh 'echo $SONAR_HOST_URL'
        }
      }
     }
    
    

   
    stage('Build') {
      steps {
        sh 'docker build -t khalidrepo/khalid-repo .'
      }
    }

    stage('Login') {
      steps {
        withCredentials([
          usernamePassword(
            credentialsId: 'dockerhub',
            usernameVariable: ‘NEXUS_USER',
            passwordVariable: ’NEXUS_PASSWORD'
          )
        ]) {
          sh "docker login -u $NEXUS_USER -p $NEXUS_PASSWORD"
        }
      }
    }

stage('TrivyScan') {
  steps {
    sh 'trivy image khalideas/frontendpipeline'
  }
}
stage("upload artifact")
  steps {
   nexusArtifactUploader(
        nexusVersion: 'nexus-3.57.0-01',
        protocol: 'http',
        nexusUrl: 'my.nexus.address',
        groupId: 'com.example',
        version: version,
        repository: 'khalid-repo',
        credentialsId: 'nexusrm',
        artifacts: [
            [artifactId: projectName,
             classifier: '',
             file: 'my-service-' + version + '.jar',
             type: 'jar']
        ]
     )
}
